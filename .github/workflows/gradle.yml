# This workflow will build a Java project with Gradle
# For more information see: https://help.github.com/actions/language-and-framework-guides/building-and-testing-java-with-gradle

name: Java CI with Gradle

on:
 push:
    branches:
       - '*'
    paths:
      - "kotlin/**"
 pull_request:
    branches:
      - '*'
    paths:
      - "kotlin/**"
 workflow_dispatch:
  

jobs:
  build-loader:
    runs-on: ubuntu-latest
    steps:
    - name: checkout
      uses: actions/checkout@v2
#     - name: Cache Gradle packages
#       uses: actions/cache@v2
#       with:
#        path: |
#          ./kotlin/.gradle
#        key: ${{ runner.os }}-build-${{ env.cache-name }}
#     - name: Set up JDK 15
#       uses: actions/setup-java@v2
#       with:
#         java-version: '15'
#         distribution: 'adopt'
    - name: chmod -R 777 *
      run: chmod -R 777 *
    - name: Build loader
      run:  cd ./kotlin/ && ./gradlew MiraiCP-loader:shadowJar --warning-mode all --info --stacktrace
   
  build-plugin:
    runs-on: ubuntu-latest
    steps:
    - name: checkout
      uses: actions/checkout@v2
    - name: chmod -R 777 *
      run: chmod -R 777 *
    - name: Build plugin
      run:  cd ./kotlin/ && ./gradlew MiraiCP-plugin:buildPlugin --warning-mode all --info --stacktrace
